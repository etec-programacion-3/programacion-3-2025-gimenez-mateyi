# ğŸ³ InstalaciÃ³n con Docker 
## ğŸ“‹ Prerrequisitos

- **Docker Desktop** instalado y corriendo
  - Windows/Mac: https://www.docker.com/products/docker-desktop
  - Linux: `sudo apt install docker.io docker-compose`
- **Python 3.10+** instalado
- **Git** instalado

---

## ğŸš€ InstalaciÃ³n en 5 Pasos

### Paso 1: Clonar el Repositorio

```bash
git clone https://github.com/etec-programacion-3/programacion-3-2025-gimenez-mateyi-2.git
cd programacion-3-2025-gimenez-mateyi-2
```

---

### Paso 2: Iniciar MongoDB con Docker

```bash
# Iniciar MongoDB en segundo plano
docker-compose up -d

# Verificar que estÃ¡ corriendo
docker-compose ps
```

**Salida esperada:**
```
NAME                 IMAGE              STATUS
gimenez-mongodb      mongo:7.0          Up 10 seconds (healthy)
gimenez-mongo-express mongo-express:1.0-20 Up 8 seconds
```

**â±ï¸ Tiempo:** ~30 segundos (primera vez descarga la imagen)

---

### Paso 3: Configurar Variables de Entorno

```bash
cd BACKEND
cp .env.local .env
```

O crear el archivo `.env` manualmente:

```env
MONGO_URL=mongodb://admin:admin123@localhost:27017/concesionaria?authSource=admin
SECRET_KEY=clave_secreta_para_evaluacion_prog3_2025
```

---

### Paso 4: Instalar Dependencias de Python

```bash
# Asegurarse de estar en BACKEND/
pip install -r requirements.txt
```

**Dependencias instaladas:**
- Flask
- Flask-Login
- pymongo
- bcrypt
- python-dotenv

---

### Paso 5: Ejecutar la AplicaciÃ³n

```bash
python app.py
```

**Salida esperada:**
```
============================================================
ğŸš— GIMÃ‰NEZ AUTOMOTORES - SERVIDOR INICIANDO
============================================================
ğŸ“ URL: http://127.0.0.1:5002
ğŸ”— MongoDB: Conectado
ğŸ” Login: http://127.0.0.1:5002/login
============================================================
```

**ğŸ‰ Listo!** Abrir http://127.0.0.1:5002 en el navegador

---

## ğŸ” Credenciales de Prueba

### AplicaciÃ³n Web
- **Admin:** 
  - Usuario: `admin`
  - ContraseÃ±a: `admin123`
  - URL: http://127.0.0.1:5002/login

### Mongo Express (Interfaz visual de BD - OPCIONAL)
- **URL:** http://localhost:8081
- **Usuario:** `admin`
- **ContraseÃ±a:** `admin123`

---

## âœ… VerificaciÃ³n de Funcionamiento

### Test 1: MongoDB estÃ¡ corriendo
```bash
docker-compose ps
```

DeberÃ­a mostrar 2 contenedores corriendo (mongodb y mongo-express)

### Test 2: ConexiÃ³n desde Python
```bash
cd BACKEND
python -c "from models import VehiculoDB; db = VehiculoDB(); print('âœ… Conectado' if db.client else 'âŒ Error')"
```

DeberÃ­a imprimir: `âœ… Conectado`

### Test 3: VehÃ­culos en la BD
```bash
python -c "from models import VehiculoDB; db = VehiculoDB(); print(f'VehÃ­culos en BD: {len(db.obtener_vehiculos())}')"
```

DeberÃ­a imprimir: `VehÃ­culos en BD: 5`

### Test 4: AplicaciÃ³n web
```bash
curl http://127.0.0.1:5002/
```

DeberÃ­a devolver HTML (pÃ¡gina de inicio)

---

## ğŸ“Š Datos Precargados

Al iniciar Docker por primera vez, se cargan automÃ¡ticamente:

### VehÃ­culos (5 modelos FIAT):
1. **Fiat Cronos** - $15.000.000 (SedÃ¡n)
2. **Fiat Argo** - $12.000.000 (Hatchback)
3. **Fiat Pulse** - $32.000.000 (SUV)
4. **Fiat Toro** - $23.000.000 (Pickup)
5. **Fiat 500** - $18.000.000 (City car)

### Usuario Admin:
- Username: `admin`
- Password: `admin123`
- Role: `admin`

---

## ğŸ§ª Probar la API

### OpciÃ³n 1: REST Client (VS Code)
```bash
# 1. Instalar extensiÃ³n "REST Client" en VS Code
# 2. Abrir archivo: requests.http
# 3. Click en "Send Request" sobre cada peticiÃ³n
```

### OpciÃ³n 2: Postman
```bash
# 1. Abrir Postman
# 2. Import â†’ Gimenez_Automotores.postman_collection.json
# 3. Ejecutar peticiones
```

### OpciÃ³n 3: curl (Terminal)
```bash
# Ver vehÃ­culos destacados
curl http://127.0.0.1:5002/api/vehiculos/destacados

# Login
curl -X POST http://127.0.0.1:5002/login \
  -d "username=admin&password=admin123"
```

---

## ğŸ› ï¸ Comandos Ãštiles de Docker

### Ver logs de MongoDB
```bash
docker-compose logs -f mongodb
```

### Ver logs de la aplicaciÃ³n Python
```bash
# La app NO corre en Docker, solo MongoDB
# Los logs aparecen en la terminal donde ejecutaste python app.py
```

### Reiniciar MongoDB
```bash
docker-compose restart
```

### Detener todo
```bash
docker-compose down
```

### Eliminar TODO (incluyendo datos)
```bash
docker-compose down -v
```

### Ver datos en MongoDB (desde terminal)
```bash
docker exec -it gimenez-mongodb mongosh -u admin -p admin123 --authenticationDatabase admin
```

Luego en mongosh:
```javascript
use concesionaria
db.vehiculos.find().pretty()
db.usuarios.find().pretty()
```

---

## âŒ SoluciÃ³n de Problemas

### Error: "Cannot connect to Docker daemon"
**SoluciÃ³n:** Asegurarse de que Docker Desktop estÃ¡ corriendo

### Error: "Port 27017 is already in use"
**Causa:** MongoDB ya estÃ¡ corriendo localmente  
**SoluciÃ³n:** 
```bash
# Windows
net stop MongoDB

# Linux/Mac
sudo systemctl stop mongod

# O cambiar puerto en docker-compose.yml
ports:
  - "27018:27017"  # Cambiar a 27018
```

### Error: "Module not found"
**SoluciÃ³n:**
```bash
pip install -r requirements.txt --force-reinstall
```

### Error: "Connection refused to MongoDB"
**SoluciÃ³n:**
```bash
# 1. Verificar que Docker estÃ¡ corriendo
docker-compose ps

# 2. Ver logs
docker-compose logs mongodb

# 3. Reiniciar
docker-compose restart
```

### Docker Compose no funciona
**SoluciÃ³n:**
```bash
# Verificar versiÃ³n
docker-compose --version

# Si no estÃ¡ instalado (Linux)
sudo apt install docker-compose
```

---

## ğŸ”„ Reiniciar desde Cero

Si algo sale mal, empezar de nuevo:

```bash
# 1. Detener y eliminar todo
docker-compose down -v

# 2. Eliminar cachÃ© de Python
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null

# 3. Volver a empezar desde el Paso 2
docker-compose up -d
cd BACKEND
cp .env.local .env
pip install -r requirements.txt
python app.py
```

---

## ğŸ“‚ Estructura de Archivos

```
programacion-3-2025-gimenez-mateyi-2/
â”œâ”€â”€ docker-compose.yml          â† ConfiguraciÃ³n de Docker
â”œâ”€â”€ init-mongo.js              â† Script de inicializaciÃ³n de BD
â”œâ”€â”€ README.md                  â† DocumentaciÃ³n completa
â”œâ”€â”€ requests.http              â† Pruebas de API
â”œâ”€â”€ BACKEND/
â”‚   â”œâ”€â”€ .env.local            â† Plantilla de configuraciÃ³n
â”‚   â”œâ”€â”€ app.py                â† AplicaciÃ³n Flask (ejecutar este)
â”‚   â”œâ”€â”€ models.py             â† Modelos y conexiÃ³n a MongoDB
â”‚   â”œâ”€â”€ requirements.txt      â† Dependencias Python
â”‚   â””â”€â”€ routes/               â† Endpoints organizados
â””â”€â”€ FRONTEND/
    â”œâ”€â”€ templates/            â† Plantillas HTML
    â””â”€â”€ static/              â† CSS, JS, imÃ¡genes
```

---

## ğŸ¯ Funcionalidades para Evaluar

### PÃºblicas (sin login):
1. âœ… Ver catÃ¡logo de vehÃ­culos
2. âœ… Ver detalle de cada vehÃ­culo
3. âœ… Cotizar vehÃ­culo usado
4. âœ… Enviar mensaje de contacto
5. âœ… Ver planes de financiaciÃ³n
6. âœ… Ver quiÃ©nes somos

### Admin (admin/admin123):
1. âœ… CRUD completo de vehÃ­culos
2. âœ… Ver mensajes de clientes
3. âœ… Panel de administraciÃ³n
4. âœ… GestiÃ³n de stock

### API REST:
1. âœ… GET /api/vehiculos/destacados
2. âœ… POST /login
3. âœ… POST /register
4. âœ… POST /admin/vehiculo/crear
5. âœ… POST /admin/vehiculo/editar/:id
6. âœ… POST /admin/vehiculo/eliminar/:id

---
